package main

import (
	"fmt"
	"sync"
	"time"
)

// –í–æ–ª–∫ –∏ –ó–∞—è—Ü –∏–∑ "–ù—É, –ø–æ–≥–æ–¥–∏!" –ø–æ–ø–∞–ª–∏ –≤ –º–∏—Ä –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∏
type FairyTaleAdventure struct {
	wg          sync.WaitGroup
	gnomes      []string
	tasks       []string
	completed   int
}

func main() {
	fmt.Println("üé≠ –°–ú–ï–®–ê–ù–ù–ê–Ø –í–°–ï–õ–ï–ù–ù–ê–Ø: –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç '–ù—É, –ø–æ–≥–æ–¥–∏!'")
	fmt.Println("=======================================================")

	adventure := &FairyTaleAdventure{
		gnomes: []string{"–£–º–Ω–∏–∫", "–í–æ—Ä—á—É–Ω", "–í–µ—Å–µ–ª—å—á–∞–∫", "–°–æ–Ω—è", "–°–∫—Ä–æ–º–Ω–∏–∫", "–ß–∏—Ö—É–Ω", "–ü—Ä–æ—Å—Ç–∞—á–æ–∫"},
		tasks: []string{
			"—Å–æ–±—Ä–∞—Ç—å –∞–ª–º–∞–∑—ã –≤ —à–∞—Ö—Ç–µ",
			"–ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å —É–∂–∏–Ω –¥–ª—è –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∏",
			"–ø–æ—á–∏–Ω–∏—Ç—å –º–æ—Å—Ç —á–µ—Ä–µ–∑ —Ä–µ–∫—É",
			"–Ω–∞—É—á–∏—Ç—å –ó–∞–π—Ü–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Go",
			"—Å–ø—Ä—è—Ç–∞—Ç—å —è–±–ª–æ–∫–∏ –æ—Ç –í–æ–ª–∫–∞",
			"–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–ª–µ–ø–æ—Ä—Ç –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è",
			"–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏–∫ —Å–ø–∞—Å–µ–Ω–∏—è",
		},
	}

	fmt.Println("üê∫ –í–æ–ª–∫ –≥–æ–Ω–∏—Ç—Å—è –∑–∞ –ó–∞–π—Ü–µ–º –ø–æ —Å–∫–∞–∑–æ—á–Ω–æ–º—É –ª–µ—Å—É...")
	fmt.Println("üö® –í–ù–ï–ó–ê–ü–ù–û: –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ó–ª–∞—è –ö–æ—Ä–æ–ª–µ–≤–∞ —Å –æ—Ç—Ä–∞–≤–ª–µ–Ω–Ω—ã–º —è–±–ª–æ–∫–æ–º!")
	fmt.Println("üì¢ –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∞ –∫—Ä–∏—á–∏—Ç: '–ì–Ω–æ–º—ã, –ø–æ–º–æ–≥–∏—Ç–µ! –ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –¥–æ –∑–∞–∫–∞—Ç–∞!'")

	// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑ WaitGroup
	fmt.Println("\n‚ùå –°–ò–¢–£–ê–¶–ò–Ø: –ì–Ω–æ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ë–ï–ó –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏...")
	adventure.workWithoutWaitGroup()

	fmt.Println("\nüí• –ö–ê–¢–ê–°–¢–†–û–§–ê: –í–æ–ª–∫ –ø–æ—á—Ç–∏ –ø–æ–π–º–∞–ª –ó–∞–π—Ü–∞, –∞ –ö–æ—Ä–æ–ª–µ–≤–∞ –Ω–∞—à–ª–∞ –ë–µ–ª–æ—Å–Ω–µ–∂–∫—É!")
	fmt.Println("üò± –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞–¥–∞—á:", adventure.completed, "–∏–∑", len(adventure.tasks))

	// –°–±—Ä–æ—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
	adventure.completed = 0

	// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è —Å WaitGroup
	fmt.Println("\n‚úÖ –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–≥–∏—é WaitGroup –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏!")
	adventure.workWithWaitGroup()

	fmt.Println("\nüéâ –ü–û–ë–ï–î–ê: –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! –í–æ–ª–∫ –ø–æ–¥—Ä—É–∂–∏–ª—Å—è —Å –ó–∞–π—Ü–µ–º, –ö–æ—Ä–æ–ª–µ–≤–∞ —Ä–∞—Å–∫–∞—è–ª–∞—Å—å!")
	fmt.Println("üèÜ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞–¥–∞—á:", adventure.completed, "–∏–∑", len(adventure.tasks))
	fmt.Println("‚ú® –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∞, –ó–∞—è—Ü –∏ –í–æ–ª–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É—é—Ç –Ω–∞ Go –≤–º–µ—Å—Ç–µ!")
}

// workWithoutWaitGroup - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Ö–∞–æ—Å)
func (a *FairyTaleAdventure) workWithoutWaitGroup() {
	for i, gnome := range a.gnomes {
		go func(id int, name string, task string) {
			// –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –≥–Ω–æ–º–∞ (—Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è)
			workTime := time.Duration(500*(id+1)) * time.Millisecond
			time.Sleep(workTime)

			fmt.Printf("   %s: '%s' - –í–´–ü–û–õ–ù–ï–ù–û! (–∑–∞—Ç—Ä–∞—Ç–∏–ª %v)\n", name, task, workTime)
			a.completed++
		}(i, gnome, a.tasks[i])
	}

	// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–µ –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω
	time.Sleep(1 * time.Second) // –ñ–¥—ë–º —Ç–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥—É
	fmt.Println("\n‚è∞ –í–†–ï–ú–Ø –í–´–®–õ–û! –ì–ª–∞–≤–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É...")
}

// workWithWaitGroup - —Ä–∞–±–æ—Ç–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π (–ø–æ—Ä—è–¥–æ–∫)
func (a *FairyTaleAdventure) workWithWaitGroup() {
	// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
	a.wg.Add(len(a.gnomes))

	for i, gnome := range a.gnomes {
		go func(id int, name string, task string) {
			// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
			defer a.wg.Done()

			// –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –≥–Ω–æ–º–∞
			workTime := time.Duration(500*(id+1)) * time.Millisecond
			time.Sleep(workTime)

			fmt.Printf("   %s: '%s' - –í–´–ü–û–õ–ù–ï–ù–û! (–∑–∞—Ç—Ä–∞—Ç–∏–ª %v)\n", name, task, workTime)
			a.completed++
		}(i, gnome, a.tasks[i])
	}

	fmt.Println("üîÑ WaitGroup –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –í–°–ï–• –∑–∞–¥–∞—á...")
	a.wg.Wait() // ‚úÖ –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –í–°–ï–• –≥–æ—Ä—É—Ç–∏–Ω
	fmt.Println("üéØ WaitGroup: –í—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")
}

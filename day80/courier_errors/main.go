package main

import (
	"errors"
	"fmt"
	"log"
)

// Package –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Å—ã–ª–∫—É
type Package struct {
	ID, Destination, Contents string
}

// Courier –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞—à–µ–≥–æ –≥–µ—Ä–æ—è
type Courier struct {
	Name    string
	Packages []Package
	Route   []string
}

// =========== –ú–û–î–ï–õ–ò–†–£–ï–ú –¶–ï–ü–û–ß–ö–£ –î–û–°–¢–ê–í–ö–ò –° –û–®–ò–ë–ö–ê–ú–ò ===========

// 1. –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ—à–∏–±–∫–∞: —Å–∫–∞–Ω–µ—Ä –Ω–µ —á–∏—Ç–∞–µ—Ç —à—Ç—Ä–∏—Ö-–∫–æ–¥
func scanBarcode(p Package) error {
	if p.ID == "" {
		// –ë–∞–∑–æ–≤–∞—è –æ—à–∏–±–∫–∞ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
		return errors.New("—à—Ç—Ä–∏—Ö-–∫–æ–¥ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
	}
	return nil
}

// 2. –û—à–∏–±–∫–∞ —É—Ä–æ–≤–Ω—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ fmt.Errorf
func loadPackage(p Package) error {
	if err := scanBarcode(p); err != nil {
		// –û–ë–†–ê–¢–ò –í–ù–ò–ú–ê–ù–ò–ï: –ó–¥–µ—Å—å –º—ã –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –æ—à–∏–±–∫–µ
		// –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –ø—Ä–∏–µ–º –¥–Ω—è - –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ (error wrapping)
		return fmt.Errorf("–Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å—ã–ª–∫—É %s –¥–ª—è –∞–¥—Ä–µ—Å–∞ %s: %w", 
			p.ID, p.Destination, err)
	}
	fmt.Printf("‚úÖ –ü–æ—Å—ã–ª–∫–∞ %s '%s' –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ê–¥—Ä–µ—Å: %s\n", 
		p.ID, p.Contents, p.Destination)
	return nil
}

// 3. –û—à–∏–±–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –µ—â–µ –æ–¥–Ω–æ–≥–æ —Å–ª–æ—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
func planRoute(destinations []string) ([]string, error) {
	if len(destinations) == 0 {
		return nil, fmt.Errorf("–æ—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞: —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤ –ø—É—Å—Ç")
	}
	
	// –ì–æ—à–∞ - –æ–ø—ã—Ç–Ω—ã–π –∫—É—Ä—å–µ—Ä, –Ω–æ –¥–∞–∂–µ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö —Å—Ä–∞–∑—É
	for _, addr := range destinations {
		if addr == "" {
			return nil, fmt.Errorf("–æ—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: –æ–±–Ω–∞—Ä—É–∂–µ–Ω –ø—É—Å—Ç–æ–π –∞–¥—Ä–µ—Å –≤ —Å–ø–∏—Å–∫–µ")
		}
	}
	
	fmt.Printf("üó∫Ô∏è  –ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω: %v\n", destinations)
	return destinations, nil
}

// 4. –§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø –¥–æ—Å—Ç–∞–≤–∫–∏ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
func deliverPackage(courier Courier) error {
	fmt.Printf("\nüöÄ %s –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å. –ü–æ—Å—ã–ª–æ–∫ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ: %d\n", 
		courier.Name, len(courier.Packages))
	
	// –ü–ª–∞–Ω–∏—Ä—É–µ–º –º–∞—Ä—à—Ä—É—Ç
	route, err := planRoute(courier.Route)
	if err != nil {
		return fmt.Errorf("—Å–±–æ–π –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –¥–Ω—è: %w", err)
	}
	
	// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –ø–æ—Å—ã–ª–∫—É
	for i, pkg := range courier.Packages {
		fmt.Printf("\n--- –î–æ—Å—Ç–∞–≤–∫–∞ %d/%d ---\n", i+1, len(courier.Packages))
		
		// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å—ã–ª–∫–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
		if err := loadPackage(pkg); err != nil {
			// –ú—ã –ø–æ–ª—É—á–∞–µ–º —É–∂–µ –æ–±–µ—Ä–Ω—É—Ç—É—é –æ—à–∏–±–∫—É –∏–∑ loadPackage
			// –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–µ—Å—Ç–µ
			return fmt.Errorf("—Å—Ä—ã–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ %s (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ %d): %w", 
				route[i], i+1, err)
		}
		
		// –°–∏–º—É–ª—è—Ü–∏—è –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–æ–π –æ—à–∏–±–∫–∏ –≤ –ø—É—Ç–∏
		if pkg.Destination == "–ë–¶ '–û—Å—Ç—Ä–æ–≤'" && i == 1 {
			iceError := fmt.Errorf("–≥–æ–ª–æ–ª–µ–¥ –Ω–∞ –≤—ä–µ–∑–¥–µ –≤ –ø–æ–¥–∑–µ–º–Ω—ã–π –ø–∞—Ä–∫–∏–Ω–≥")
			log.Printf("‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: %v", iceError)
			// –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –º—ã –ù–ï –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∞ –ª–æ–≥–∏—Ä—É–µ–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
			// –≠—Ç–æ –≤–∞–∂–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ recoverable errors
		}
		
		fmt.Printf("üì¶ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ '%s'! –û—Å—Ç–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–æ–∫: %d\n", 
			route[i], len(route)-i-1)
	}
	
	return nil
}

// =========== –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø - –ò–°–¢–û–†–ò–Ø –î–ù–Ø ===========
func main() {
	fmt.Println("=================================================")
	fmt.Println("        –ö–£–†–¨–ï–†–°–ö–ê–Ø –°–ê–ì–ê: –î–ï–ù–¨ 80")
	fmt.Println("   –û—à–∏–±–∫–∏ - –∫–∞–∫ –≥–æ–ª–æ–ª–µ–¥ –Ω–∞ –ø—É—Ç–∏ –∫ —Ü–µ–ª–∏")
	fmt.Println("=================================================\n")
	
	// –°–æ–∑–¥–∞–µ–º –Ω–∞—à–µ–≥–æ –≥–µ—Ä–æ—è
	gosh := Courier{
		Name: "–ì–æ—à–∞",
		Packages: []Package{
			{ID: "PKG-2025-001", Destination: "–ú–ú–î–¶ '–ú–æ—Å–∫–≤–∞-–°–∏—Ç–∏'", Contents: "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã"},
			{ID: "PKG-2025-002", Destination: "–ë–¶ '–û—Å—Ç—Ä–æ–≤'", Contents: "–û–±—Ä–∞–∑—Ü—ã –ø—Ä–æ–¥—É–∫—Ü–∏–∏"},
			{ID: "", Destination: "–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä-—Ç, 123", Contents: "–ß–µ—Ä—Ç–µ–∂–∏"}, // –ü—Ä–æ–±–ª–µ–º–Ω–∞—è –ø–æ—Å—ã–ª–∫–∞!
			{ID: "PKG-2025-004", Destination: "–ë–¶ '–°–æ–∫–æ–ª–∏–Ω–∞—è –≥–æ—Ä–∞'", Contents: "–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã"},
		},
		Route: []string{
			"–ú–ú–î–¶ '–ú–æ—Å–∫–≤–∞-–°–∏—Ç–∏'",
			"–ë–¶ '–û—Å—Ç—Ä–æ–≤'",
			"–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä-—Ç, 123",
			"–ë–¶ '–°–æ–∫–æ–ª–∏–Ω–∞—è –≥–æ—Ä–∞'",
		},
	}
	
	// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏
	if err := deliverPackage(gosh); err != nil {
		// –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ü–µ–ø–æ—á–∫—É
		fmt.Println("\n‚ùå‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ùå")
		fmt.Println("–§–ê–¢–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –ú–ê–†–®–†–£–¢–ê:")
		fmt.Printf("–î–µ—Ç–∞–ª–∏: %v\n", err)
		fmt.Println("\nüîç –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –æ—à–∏–±–∫–∏ (unwrapping):")
		
		// –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É –∏–∑ —Ü–µ–ø–æ—á–∫–∏
		originalErr := errors.Unwrap(err)
		for originalErr != nil {
			fmt.Printf("   ‚Üê %v\n", originalErr)
			originalErr = errors.Unwrap(originalErr)
		}
		
		fmt.Println("\nüí° –ì–æ—à–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É, –¥–µ–ª–∞–µ—Ç –ø–æ–º–µ—Ç–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏")
		fmt.Println("   –∏ –∑–≤–æ–Ω–∏—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.")
		fmt.Println("   –ó–∞–≤—Ç—Ä–∞ –æ–Ω —Å–º–æ–∂–µ—Ç –¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ!")
		fmt.Println("‚ùå‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ùå")
		
		// –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –≤—ã–∑–æ–≤ log.Fatal –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –≤—ã—à–µ
		log.Printf("–†–∞–±–æ—á–∏–π –¥–µ–Ω—å –ø—Ä–µ—Ä–≤–∞–Ω: %v", err)
		return
	}
	
	fmt.Println("\nüéâ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêüéâ")
	fmt.Println("–í–°–ï –ü–û–°–´–õ–ö–ò –î–û–°–¢–ê–í–õ–ï–ù–´! –†–ê–ë–û–ß–ò–ô –î–ï–ù–¨ –ó–ê–í–ï–†–®–ï–ù.")
	fmt.Printf("–ò—Ç–æ–≥: %s - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª, –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≤–æ–¥–∏—Ç.\n", gosh.Name)
	fmt.Println("üéâ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêüéâ")
}

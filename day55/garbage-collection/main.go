package main

import (
	"fmt"
	"log"
	"os"
	"runtime"
	"time"
)

// Parcel –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑ –∫—É—Ä—å–µ—Ä–∞
type Parcel struct {
	ID       string
	Distance float64 // –∫–º
	Profit   float64 // —Ä—É–±–ª–∏
}

func main() {
	log.Println("üåü –ü—Ä–∏–≤–µ—Ç, –ì–æ—à–∞! –°–µ–≥–æ–¥–Ω—è 28 –¥–µ–∫–∞–±—Ä—è 2025. –¢–≤–æ–∏ –±–æ–ª—å–Ω—ã–µ –Ω–æ–≥–∏ –æ—Ç–¥—ã—Ö–∞—é—Ç –æ—Ç –∫—É—Ä—å–µ—Ä–∫–∏, –Ω–æ –º–æ–∑–≥ —É—á–∏—Ç Go!")

	// –®–∞–≥ 1: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞–º—è—Ç–∏
	log.Println("\nüìä –°—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏ (–ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π):")
	printMemStats()

	// –®–∞–≥ 2: –°–æ–∑–¥–∞—ë–º "–∑–∞–∫–∞–∑—ã" (–æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–æ—Ä–æ —Å—Ç–∞–Ω—É—Ç –º—É—Å–æ—Ä–æ–º)
	log.Println("\nüì¶ –°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–∫–∞–∫ –±—É–¥—Ç–æ –±–µ–≥–∞–ª –ø–æ –ú–æ—Å–∫–≤–µ –≤ –±–æ—Ç–∏–Ω–∫–∞—Ö —Å –∫–∞–±–ª—É–∫–æ–º)...")
	parcels := generateWinterParcels(50000) // 50–∫ –∑–∞–∫–∞–∑–æ–≤ = —É—Å—Ç–∞–ª–æ—Å—Ç—å –Ω–æ–≥

	// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é parcels, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
	// –°—á–∏—Ç–∞–µ–º –æ–±—â—É—é –ø—Ä–∏–±—ã–ª—å –∑–∞ "–¥–µ–Ω—å" ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –∫—É—Ä—å–µ—Ä–∞!
	totalProfit := calculateTotalProfit(parcels)
	log.Printf("   üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–µ–Ω—å: %.2f —Ä—É–±–ª–µ–π (—Ö–≤–∞—Ç–∏—Ç –Ω–∞ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–π —Å—É–ø—á–∏–∫ —Å –∫—É—Ä–æ—á–∫–æ–π!)\n", totalProfit)

	time.Sleep(500 * time.Millisecond) // –î–∞—ë–º GC –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é

	// –®–∞–≥ 3: "–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ–º —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å" ‚Äî —É–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–∫–∞–∑—ã
	log.Println("\nüõå –ó–∞–∫–∞–∑—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! –û—Ç–ø—É—Å–∫–∞–µ–º –ø–∞–º—è—Ç—å (–∫–∞–∫ —Ç–≤–æ–∏ –Ω–æ–≥–∏ –æ—Ç–¥—ã—Ö–∞—é—Ç –Ω–∞ –¥–∏–≤–∞–Ω–µ)...")
	parcels = nil // –û–±—ä–µ–∫—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è unreachable

	// –®–∞–≥ 4: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
	log.Println("\n‚ôªÔ∏è –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞ (–∫–∞–∫ —É–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è)...")
	runtime.GC() // –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—é—Ç! –¢–æ–ª—å–∫–æ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.

	// –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
	log.Println("\n‚úÖ –ü–∞–º—è—Ç—å –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞:")
	printMemStats()

	log.Println("\nüí° –í—ã–≤–æ–¥ –¥–Ω—è: –°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ Go —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–∞–∫ —Ç–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≥–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–±–µ–∂–∫–∏. –ù–µ –Ω–∞–¥–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–º—è—Ç—å—é –≤—Ä—É—á–Ω—É—é ‚Äî –¥–æ–≤–µ—Ä—è–π runtime!")
}

// generateWinterParcels —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑—ã —Å "–∑–∏–º–Ω–∏–º–∏" –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
func generateWinterParcels(count int) []*Parcel {
	result := make([]*Parcel, count)
	for i := 0; i < count; i++ {
		result[i] = &Parcel{
			ID:       fmt.Sprintf("MOSCOW-%d", i),
			Distance: 20.5 + float64(i%10),  // 20-30 –∫–º –≤ —Å–Ω–µ–∂–Ω–æ–π –∫–∞—à–µ
			Profit:   500.0 + float64(i%50), // –æ—Ç 500 —Ä—É–± –∑–∞ –∑–∞–∫–∞–∑
		}
	}
	return result
}

// calculateTotalProfit —Å—á–∏—Ç–∞–µ—Ç –æ–±—â—É—é –ø—Ä–∏–±—ã–ª—å —Å–æ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
func calculateTotalProfit(parcels []*Parcel) float64 {
	total := 0.0
	for _, p := range parcels {
		total += p.Profit
	}
	return total
}

// printMemStats –≤—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞–º—è—Ç–∏ –≤ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ
func printMemStats() {
	var m runtime.MemStats
	runtime.ReadMemStats(&m)

	alloc := m.Alloc / 1024 / 1024 // MiB
	sys := m.Sys / 1024 / 1024     // MiB
	numGC := m.NumGC               // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤ GC

	fmt.Printf("   ‚û§ –ó–∞–Ω—è—Ç–æ –ø–∞–º—è—Ç–∏ (Alloc): %d MiB\n", alloc)
	fmt.Printf("   ‚û§ –ü–∞–º—è—Ç—å –æ—Ç OS (Sys):   %d MiB\n", sys)
	fmt.Printf("   ‚û§ –¶–∏–∫–ª–æ–≤ GC:           %d\n", numGC)

	// –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –ª–µ–≥–µ–Ω–¥—ã
	if alloc > 5 {
		fmt.Println("   ‚ùÑÔ∏è –ü–∞–º—è—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, –∫–∞–∫ —É–ª–∏—Ü—ã —Å–Ω–µ–∂–Ω–æ–π –∫–∞—à–µ–π!")
	} else {
		fmt.Println("   ‚òÄÔ∏è –ü–∞–º—è—Ç—å —á–∏—Å—Ç–∞, –∫–∞–∫ –∞—Å—Ñ–∞–ª—å—Ç –ª–µ—Ç–æ–º –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–Ω–æ–π –ø—Ä–æ–≥—É–ª–∫–µ!")
	}
}

// init –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
func init() {
	log.SetFlags(log.Ltime | log.Lshortfile)
	log.SetOutput(os.Stdout)
	if os.Getenv("DEBUG") == "1" {
		log.Println("üêû –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á—ë–Ω!")
	}
}

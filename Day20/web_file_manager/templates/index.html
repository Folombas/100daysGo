<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞ Go</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <h1>üñ•Ô∏è –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</h1>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞/–ø–∞–ø–∫–∏ -->
        <div class="card">
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç</h2>
            <form action="/create" method="POST">
                <input type="text" name="name" placeholder="–ò–º—è —Ñ–∞–π–ª–∞/–ø–∞–ø–∫–∏" required>
                <div class="checkbox">
                    <input type="checkbox" id="isDir" name="isDir">
                    <label for="isDir">–≠—Ç–æ –ø–∞–ø–∫–∞</label>
                </div>
                <textarea name="content" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞"></textarea>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>

        <!-- –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ -->
        <div class="card">
            <h2>–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
            <div class="file-actions">
                <button onclick="loadFileList()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                <input type="text" id="filePath" placeholder="–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É">
                <button onclick="readFile()">–ü—Ä–æ—á–∏—Ç–∞—Ç—å</button>
                <button onclick="deleteFile()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
            <div id="fileList" class="file-list"></div>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ -->
            <div class="file-content">
                <h3>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:</h3>
                <pre id="fileContent"></pre>
            </div>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
        function loadFileList() {
            fetch('/list')
                .then(response => response.json())
                .then(files => {
                    let html = '<ul>';
                    files.forEach(file => {
                        const icon = file.isDir ? 'üìÅ' : 'üìÑ';
                        html += `<li>${icon} ${file.name} (${formatSize(file.size)})</li>`;
                    });
                    html += '</ul>';
                    document.getElementById('fileList').innerHTML = html;
                });
        }

        // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function readFile() {
            const path = document.getElementById('filePath').value;
            if (!path) return;

            fetch(`/read?path=${encodeURIComponent(path)}`)
                .then(response => response.text())
                .then(content => {
                    document.getElementById('fileContent').textContent = content;
                });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function deleteFile() {
            const path = document.getElementById('filePath').value;
            if (!path || !confirm(`–£–¥–∞–ª–∏—Ç—å ${path}?`)) return;

            fetch(`/delete?path=${encodeURIComponent(path)}`, { method: 'POST' })
                .then(() => {
                    loadFileList();
                    document.getElementById('fileContent').textContent = '';
                    document.getElementById('filePath').value = '';
                });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
        function formatSize(bytes) {
            if (bytes === 0) return '0 –ë';
            const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', loadFileList);
    </script>
</body>

</html>
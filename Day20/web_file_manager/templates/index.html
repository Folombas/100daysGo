<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞ Go</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        /* –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        .file-item {
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            margin: 2px 0;
        }

        .file-item:hover {
            background-color: #e3f2fd;
        }

        .file-item.selected {
            background-color: #bbdefb;
            font-weight: bold;
        }

        .file-content {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            min-height: 150px;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üñ•Ô∏è –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</h1>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞/–ø–∞–ø–∫–∏ -->
        <div class="card">
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç</h2>
            <form action="/create" method="POST">
                <input type="text" name="name" placeholder="–ò–º—è —Ñ–∞–π–ª–∞/–ø–∞–ø–∫–∏" required>
                <div class="checkbox">
                    <input type="checkbox" id="isDir" name="isDir">
                    <label for="isDir">–≠—Ç–æ –ø–∞–ø–∫–∞</label>
                </div>
                <textarea name="content" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞"></textarea>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>

        <!-- –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ -->
        <div class="card">
            <h2>–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
            <div class="file-actions">
                <button onclick="loadFileList()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                <button onclick="deleteSelected()" class="danger">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ</button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
            <div id="fileList" class="file-list">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤...</p>
            </div>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ -->
            <div class="file-content" id="fileContent">
                –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            </div>
        </div>
    </div>

    <script>
        let currentPath = '';

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
        function loadFileList() {
            fetch('/list')
                .then(response => response.json())
                .then(files => {
                    let html = '<div class="file-header">';
                    html += '<div>–ò–º—è</div><div>–†–∞–∑–º–µ—Ä</div><div>–¢–∏–ø</div>';
                    html += '</div>';

                    files.forEach(file => {
                        const icon = file.isDir ? 'üìÅ' : 'üìÑ';
                        const size = file.isDir ? '-' : formatSize(file.size);
                        const type = file.isDir ? '–ü–∞–ø–∫–∞' : '–§–∞–π–ª';

                        html += `
                            <div class="file-item" 
                                 data-path="${file.name}" 
                                 data-isdir="${file.isDir}"
                                 onclick="selectFile(this, '${file.name}', ${file.isDir})">
                                <div>${icon} ${file.name}</div>
                                <div>${size}</div>
                                <div>${type}</div>
                            </div>
                        `;
                    });

                    document.getElementById('fileList').innerHTML = html;
                });
        }

        // –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞
        function selectFile(element, path, isDir) {
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.file-item').forEach(el => {
                el.classList.remove('selected');
            });

            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
            element.classList.add('selected');
            currentPath = path;

            // –î–ª—è –ø–∞–ø–æ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
            if (isDir) {
                document.getElementById('fileContent').textContent = '–í—ã–±—Ä–∞–Ω–∞ –ø–∞–ø–∫–∞';
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
            fetch(`/fileinfo?path=${encodeURIComponent(path)}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('fileContent').textContent = data.content || '–§–∞–π–ª –ø—É—Å—Ç';
                })
                .catch(error => {
                    document.getElementById('fileContent').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message;
                });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞/–ø–∞–ø–∫–∏
        function deleteSelected() {
            if (!currentPath || !confirm(`–£–¥–∞–ª–∏—Ç—å "${currentPath}"?`)) return;

            fetch(`/delete?path=${encodeURIComponent(currentPath)}`, { method: 'POST' })
                .then(() => {
                    currentPath = '';
                    loadFileList();
                    document.getElementById('fileContent').textContent = '–û–±—ä–µ–∫—Ç —É–¥–∞–ª—ë–Ω';
                });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
        function formatSize(bytes) {
            if (bytes === 0) return '0 –ë';
            const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', loadFileList);
    </script>
</body>

</html>
package main

import (
	"bufio"
	"fmt"
	"math"
	"os"
	"runtime"
	"runtime/debug"
	"strconv"
	"strings"
	"time"
)

// ansi –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ANSI-–∫–æ–¥ –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
func ansi(code string) string {
	return "\033[" + code + "m"
}

// sieveOfEratosthenesOptimized ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç—å—é
func sieveOfEratosthenesOptimized(n int) []int {
	// –ü—Ä–µ–¥–≤—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å –¥–ª—è —Å–ª–∞–π—Å–∞ (—ç–∫–æ–Ω–æ–º–∏–º –∞–ª–ª–æ–∫–∞—Ü–∏–∏!)
	isPrime := make([]bool, n+1)
	for i := range isPrime {
		isPrime[i] = true
	}

	// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–µ–Ω—å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ü–∏–∫–ª–∞
	sqrtN := int(math.Sqrt(float64(n)))
	for i := 2; i <= sqrtN; i++ {
		if isPrime[i] {
			// –ú–µ—Ç–∫–∞: j = i*i, —à–∞–≥ = i
			for j := i * i; j <= n; j += i {
				isPrime[j] = false
			}
		}
	}

	// –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø—Ä–µ–¥–≤—ã–¥–µ–ª—è—è –ø–∞–º—è—Ç—å
	primes := make([]int, 0, n/10) // –≠–≤—Ä–∏—Å—Ç–∏–∫–∞: ~10% —á–∏—Å–µ–ª ‚Äî –ø—Ä–æ—Å—Ç—ã–µ
	for i := 2; i <= n; i++ {
		if isPrime[i] {
			primes = append(primes, i)
		}
	}

	return primes
}

// memorySnapshot –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–≤ –¥—É—Ö–µ Termux –Ω–∞ —Å–ª–∞–±–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ)
func memorySnapshot(label string) {
	var m runtime.MemStats
	runtime.ReadMemStats(&m)
	fmt.Printf("%süìä %s | Allocated: %s MB | Sys: %s MB | GC Pauses: %d%s\n",
		ansi("1;36"), label,
		formatMB(m.Alloc), formatMB(m.Sys),
		m.NumGC, ansi("0"))
}

func formatMB(bytes uint64) string {
	return strconv.FormatFloat(float64(bytes)/1024/1024, 'f', 2, 64)
}

// simulateLegRest –∏–º–∏—Ç–∏—Ä—É–µ—Ç –æ—Ç–¥—ã—Ö –Ω–æ–≥ ‚Äî –∫–∞–∫ GC –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å
func simulateLegRest(painLevel *int) {
	fmt.Printf("\n%sü¶µ –°–ò–ú–£–õ–Ø–¶–ò–Ø –û–¢–î–´–•–ê –ù–û–ì:%s\n", ansi("1;33"), ansi("0"))
	fmt.Println("   –ë–æ–ª–µ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã ‚Üí GC: '–ù—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è'")

	for i := 0; i < 3; i++ {
		fmt.Printf("   ‚è≥ –ú–∏–Ω—É—Ç–∞ %d: GC —Å–æ–±–∏—Ä–∞–µ—Ç '—É—Å—Ç–∞–ª–æ—Å—Ç—å'... ", i+1)
		time.Sleep(800 * time.Millisecond)
		*painLevel -= 15
		if *painLevel < 0 {
			*painLevel = 0
		}
		fmt.Printf("–ë–æ–ª—å: %d/100\n", *painLevel)
		runtime.GC() // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –º—É—Å–æ—Ä–∞
	}
	fmt.Printf("   ‚úÖ %sGC –æ—Å–≤–æ–±–æ–¥–∏–ª –Ω–µ–ø—Ä–∏—è—Ç–Ω—É—é –±–æ–ª—å!%s –ù–æ–≥–∏ –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–º—É –º–∞—Ä–∞—Ñ–æ–Ω—É.\n",
		ansi("1;32"), ansi("0"))
}

func main() {
	fmt.Printf("\n%süì± 27 –î–ï–ö–ê–ë–†–Ø 2025: MEMORY MANAGEMENT –í TERMUX –ù–ê –ú–ï–¢–†–û%s\n",
		ansi("1;34"), ansi("0"))
	fmt.Println(strings.Repeat("‚ïê", 55))

	// –°–∏–º—É–ª—è—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
	currentTime := time.Now().Format("15:04")
	footPain := 85 // –£—Ä–æ–≤–µ–Ω—å –±–æ–ª–∏ –ø–æ—Å–ª–µ 20 –∫–º/–¥–µ–Ω—å

	fmt.Printf("%s‚è∞ –°–µ–π—á–∞—Å:%s %s | %s–°—Ç–∞—Ç—É—Å:%s –ë–æ–ª—å –≤ –Ω–æ–≥–∞—Ö –ø–æ—Å–ª–µ –Ω–µ–¥–µ–ª–∏ —Ö–æ–¥—å–±—ã\n",
		ansi("1;36"), ansi("0"), currentTime,
		ansi("1;36"), ansi("0"))

	// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
	memorySnapshot("–î–û –†–ê–ë–û–¢–´")

	// –ó–∞–ø—É—Å–∫ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –†–µ—à–µ—Ç–∞ –≠—Ä–∞—Ç–æ—Å—Ñ–µ–Ω–∞
	fmt.Printf("\n%süß† –†–ï–®–ï–¢–û –≠–†–ê–¢–û–°–§–ï–ù–ê (n=10000):%s\n", ansi("1;35"), ansi("0"))
	primes := sieveOfEratosthenesOptimized(10000)
	fmt.Printf("   ‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ—Å—Ç—ã—Ö —á–∏—Å–µ–ª: %d\n", len(primes))
	fmt.Printf("   üí° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ü—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ + –±–∏—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞\n")

	// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã
	memorySnapshot("–ü–û–°–õ–ï –ê–õ–ì–û–†–ò–¢–ú–ê")

	// –ê–Ω–∞–ª–∏–∑ —É—Ç–µ—á–µ–∫ (–≤ –¥—É—Ö–µ Termux —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é)
	debug.FreeOSMemory()
	memorySnapshot("–ü–û–°–õ–ï GC.FREEOSMEMORY()")

	// –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–¥—ã—Ö–∞ –Ω–æ–≥ –∫–∞–∫ –∞–Ω–∞–ª–æ–≥–∏—è —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞
	simulateLegRest(&footPain)

	// –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –≤—ã–≤–æ–¥
	fmt.Println("\n" + strings.Repeat("‚ïê", 55))
	fmt.Printf("%süí° –ü–ê–ú–Ø–¢–¨ –¢–ï–õ–ê VS –ü–ê–ú–Ø–¢–¨ –ö–û–î–ê:%s\n", ansi("1;33"), ansi("0"))
	fmt.Println("   '–í Go —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –ø–∞–º—è—Ç–∏, –∫–∞–∫ —Ç—ã –¥–æ–ª–∂–µ–Ω –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –Ω–æ–≥–∞—Ö.'")
	fmt.Println("   'Termux –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –Ω–µ –ø—Ä–æ—â–∞–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏. –ñ–∏–∑–Ω—å –Ω–µ –ø—Ä–æ—â–∞–µ—Ç —É—Ç–µ—á–∫–∏ —Å–∏–ª.'")
	fmt.Println("   '–†–µ—à–µ—Ç–æ –≠—Ä–∞—Ç–æ—Å—Ñ–µ–Ω–∞ —É—á–∏—Ç: –¥–∞–∂–µ –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–æ—Ç—É.'")

	// –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: –≤—ã–±–æ—Ä –¥–ª—è –∑–∞–≤—Ç—Ä–∞
	interactiveTomorrow(footPain)
}

func interactiveTomorrow(painLevel int) {
	fmt.Println("\n" + strings.Repeat("=", 55))
	fmt.Printf("%süåÖ –ü–õ–ê–ù–´ –ù–ê –ó–ê–í–¢–†–ê (28 –î–ï–ö–ê–ë–†–Ø):%s\n", ansi("1;34"), ansi("0"))
	fmt.Printf("1. –û—Ç–¥—ã—Ö –¥–ª—è –Ω–æ–≥ + 2 —á–∞—Å–∞ Go (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö)\n")
	fmt.Printf("2. 4 –∑–∞–∫–∞–∑–∞ + –∏–∑—É—á–µ–Ω–∏–µ sync.Pool –≤ –º–µ—Ç—Ä–æ\n")
	fmt.Printf("3. –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å –∫–æ–¥–∏–Ω–≥–∞ –¥–æ–º–∞ (—Ä–µ–ø–∞–∫—Ç–∏–Ω–≥ –Ω–æ–≥ –≤ –ª–µ–¥—è–Ω—ã–µ –∫–æ–º–ø—Ä–µ—Å—Å—ã)\n")

	reader := bufio.NewReader(os.Stdin)
	fmt.Print("\n–í–∞—à –≤—ã–±–æ—Ä (1-3): ")
	choice, _ := reader.ReadString('\n')
	choice = strings.TrimSpace(choice)

	fmt.Println("\n" + strings.Repeat("-", 30))

	switch choice {
	case "1":
		fmt.Printf("%süßò –°–¢–†–ê–¢–ï–ì–ò–ß–ï–°–ö–ò–ô –û–¢–î–´–•!%s\n", ansi("1;32"), ansi("0"))
		fmt.Println("–¢–≤–æ–∏ –Ω–æ–≥–∏ ‚Äî —ç—Ç–æ RAM –≤ Termux: –±–µ–∑ –æ—Ç–¥—ã—Ö–∞ –≤—Å—ë —É–ø–∞–¥—ë—Ç.")
		fmt.Println("2 —á–∞—Å–∞ Go = –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ –±—É–¥—É—â–µ–µ, –≥–¥–µ –±–æ–ª—å –≤ –Ω–æ–≥–∞—Ö –∑–∞–º–µ–Ω–∏—Ç –±–æ–ª—å –≤ –≥–æ–ª–æ–≤–µ –æ—Ç legacy-–∫–æ–¥–∞.")
	case "2":
		fmt.Printf("%s‚öñÔ∏è –ë–ê–õ–ê–ù–° –†–ï–ê–õ–¨–ù–û–°–¢–ï–ô!%s\n", ansi("1;33"), ansi("0"))
		fmt.Println("sync.Pool –≤ Go –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã. –¢–æ—á–Ω–æ —Ç–∞–∫ –∏ —Ç—ã:")
		fmt.Println("–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—à—å —Å–∏–ª—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤—ã –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏.")
		fmt.Println("–ü–æ–º–Ω–∏: –¥–∞–∂–µ GC –¥–µ–ª–∞–µ—Ç –ø–∞—É–∑—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞. –¢—ã –∏–º–µ–µ—à—å –ø—Ä–∞–≤–æ –Ω–∞ –ø–µ—Ä–µ—Ä—ã–≤.")
	case "3":
		fmt.Printf("%süí° –§–û–ö–£–° –ù–ê –ü–ê–ú–Ø–¢–ò!%s\n", ansi("1;35"), ansi("0"))
		fmt.Println("–î–æ–º–∞—à–Ω–∏–π –∫–æ–º—Ñ–æ—Ä—Ç = –æ—Ç–ª–∞–¥–∫–∞ –±–µ–∑ —É—Ç–µ—á–µ–∫. –ù–æ –Ω–µ –∑–∞–±—ã–≤–∞–π:")
		fmt.Println("runtime.GC() –Ω–µ –∑–∞–º–µ–Ω–∏—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞. –°–¥–µ–ª–∞–π –ø–µ—Ä–µ—Ä—ã–≤ –∫–∞–∂–¥—ã–µ 45 –º–∏–Ω—É—Ç.")
	default:
		fmt.Printf("%s‚ùì –ù–ï–û–ü–†–ï–î–ï–õ–Å–ù–ù–û–°–¢–¨...%s\n", ansi("1;31"), ansi("0"))
		fmt.Println("–ù–æ –µ—Å—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞: –∑–∞–≤—Ç—Ä–∞ —Ç—ã –ø—Ä–æ—Å–Ω—ë—à—å—Å—è —Å –º—ã—Å–ª—å—é –æ –∫–æ–¥–µ, –∞ –Ω–µ –æ –±–æ–ª–∏.")
		fmt.Println("–ü–æ—Ç–æ–º—É —á—Ç–æ 54 –¥–Ω—è –Ω–∞–∑–∞–¥ —Ç—ã –Ω–∞—á–∞–ª –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Å–≤–æ—é —Å—É–¥—å–±—É,")
		fmt.Println("–∫–∞–∫ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—à—å –∞–ª–ª–æ–∫–∞—Ü–∏—é –ø–∞–º—è—Ç–∏ –ø–æ–¥ –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏.")
	}
}
